name: Generate Changelog for Pull Request

on:
  pull_request:
    branches: [ master ]  # Workflow wird ausgelöst, wenn ein PR auf den 'master' Branch gerichtet ist
    types: [opened, synchronize]

jobs:
  generate_changelog:
    runs-on: ubuntu-latest
    name: Generate Changelog for PR Commits

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4  # Repository wird ausgecheckt, um auf Commits zuzugreifen

    - name: Generate Changelog
      run: |
        # Generiere die Changelog-Datei für die Commits in diesem Pull Request
        echo "## Changelog for PR #${{ github.event.pull_request.number }}" > CHANGELOG.md
        echo "" >> CHANGELOG.md
        git log origin/master..HEAD --oneline >> CHANGELOG.md  # Log der PR-Commits

    - name: Display Changelog (for debugging)
      run: cat CHANGELOG.md  # Zeigt die Changelog-Datei an, um den Inhalt zu prüfen

    - name: Comment on Pull Request with Changelog
      uses: marocchino/sticky-pull-request-comment@v2
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        header: changelog
        message: |
          ## Changelog
          ```markdown
          $(cat CHANGELOG.md)
          ```
